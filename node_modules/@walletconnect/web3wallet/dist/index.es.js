import{AuthClient as N}from"@walletconnect/auth-client";import{SignClient as W,SessionStore as j}from"@walletconnect/sign-client";import{Core as m}from"@walletconnect/core";var l={exports:{}},h=typeof Reflect=="object"?Reflect:null,y=h&&typeof h.apply=="function"?h.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},f;h&&typeof h.ownKeys=="function"?f=h.ownKeys:Object.getOwnPropertySymbols?f=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:f=function(t){return Object.getOwnPropertyNames(t)};function I(n){console&&console.warn&&console.warn(n)}var w=Number.isNaN||function(t){return t!==t};function o(){o.init.call(this)}l.exports=o,l.exports.once=F,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var L=10;function g(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return L},set:function(n){if(typeof n!="number"||n<0||w(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");L=n}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||w(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _(n){return n._maxListeners===void 0?o.defaultMaxListeners:n._maxListeners}o.prototype.getMaxListeners=function(){return _(this)},o.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var u=a[t];if(u===void 0)return!1;if(typeof u=="function")y(u,this,e);else for(var v=u.length,T=b(u,v),s=0;s<v;++s)y(T[s],this,e);return!0};function S(n,t,e,s){var i,a,r;if(g(e),a=n._events,a===void 0?(a=n._events=Object.create(null),n._eventsCount=0):(a.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),a=n._events),r=a[t]),r===void 0)r=a[t]=e,++n._eventsCount;else if(typeof r=="function"?r=a[t]=s?[e,r]:[r,e]:s?r.unshift(e):r.push(e),i=_(n),i>0&&r.length>i&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=t,c.count=r.length,I(c)}return n}o.prototype.addListener=function(t,e){return S(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return S(this,t,e,!0)};function M(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(n,t,e){var s={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},i=M.bind(s);return i.listener=e,s.wrapFn=i,i}o.prototype.once=function(t,e){return g(e),this.on(t,C(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return g(e),this.prependListener(t,C(this,t,e)),this},o.prototype.removeListener=function(t,e){var s,i,a,r,c;if(g(e),i=this._events,i===void 0)return this;if(s=i[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(a=-1,r=s.length-1;r>=0;r--)if(s[r]===e||s[r].listener===e){c=s[r].listener,a=r;break}if(a<0)return this;a===0?s.shift():k(s,a),s.length===1&&(i[t]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",t,c||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var a=Object.keys(s),r;for(i=0;i<a.length;++i)r=a[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function E(n,t,e){var s=n._events;if(s===void 0)return[];var i=s[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?z(i):b(i,i.length)}o.prototype.listeners=function(t){return E(this,t,!0)},o.prototype.rawListeners=function(t){return E(this,t,!1)},o.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):O.call(n,t)},o.prototype.listenerCount=O;function O(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function b(n,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=n[s];return e}function k(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function z(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function F(n,t){return new Promise(function(e,s){function i(r){n.removeListener(t,a),s(r)}function a(){typeof n.removeListener=="function"&&n.removeListener("error",i),e([].slice.call(arguments))}R(n,t,a,{once:!0}),t!=="error"&&D(n,i,{once:!0})})}function D(n,t,e){typeof n.on=="function"&&R(n,"error",t,e)}function R(n,t,e,s){if(typeof n.on=="function")s.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function i(a){s.once&&n.removeEventListener(t,i),e(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}const x="wc",K=2,p="Web3Wallet",U=`${x}@2:${p}:`,X={database:":memory:"},$="request";class G extends l.exports{constructor(){super()}}class P{constructor(t){this.opts=t}}class q{constructor(t){this.client=t}}class H extends q{constructor(t){super(t),this.init=async()=>{this.signClient=await W.init({core:this.client.core,metadata:this.client.metadata}),this.authClient=await N.init({core:this.client.core,projectId:"",metadata:this.client.metadata}),this.initializeEventListeners()},this.pair=async e=>{await this.client.core.pairing.pair(e)},this.approveSession=async e=>{const{topic:s,acknowledged:i}=await this.signClient.approve({id:e.id,namespaces:e.namespaces});return await i(),this.signClient.session.get(s)},this.rejectSession=async e=>await this.signClient.reject(e),this.updateSession=async e=>await(await this.signClient.update(e)).acknowledged(),this.extendSession=async e=>await(await this.signClient.extend(e)).acknowledged(),this.respondSessionRequest=async e=>await this.signClient.respond(e),this.disconnectSession=async e=>await this.signClient.disconnect(e),this.emitSessionEvent=async e=>await this.signClient.emit(e),this.getActiveSessions=()=>this.signClient.session.getAll().reduce((e,s)=>(e[s.topic]=s,e),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.respondAuthRequest=async(e,s)=>await this.authClient.respond(e,s),this.getPendingAuthRequests=()=>this.authClient.requests.getAll().filter(e=>"requester"in e),this.formatMessage=(e,s)=>this.authClient.formatMessage(e,s),this.registerDeviceToken=e=>this.client.core.echoClient.registerDeviceToken(e),this.onSessionRequest=e=>{this.client.events.emit("session_request",e)},this.onSessionProposal=e=>{this.client.events.emit("session_proposal",e)},this.onSessionDelete=e=>{this.client.events.emit("session_delete",e)},this.onAuthRequest=e=>{this.client.events.emit("auth_request",e)},this.onProposalExpire=e=>{this.client.events.emit("proposal_expire",e)},this.onSessionRequestExpire=e=>{this.client.events.emit("session_request_expire",e)},this.initializeEventListeners=()=>{this.signClient.events.on("session_proposal",this.onSessionProposal),this.signClient.events.on("session_request",this.onSessionRequest),this.signClient.events.on("session_delete",this.onSessionDelete),this.authClient.on("auth_request",this.onAuthRequest),this.signClient.events.on("proposal_expire",this.onProposalExpire),this.signClient.events.on("session_request_expire",this.onSessionRequestExpire)},this.signClient={},this.authClient={}}}const Q={decryptMessage:async n=>{const t={core:new m({storageOptions:n.storageOptions,storage:n.storage})};await t.core.crypto.init();const e=t.core.crypto.decode(n.topic,n.encryptedMessage);return t.core=null,e},getMetadata:async n=>{const t={core:new m({storageOptions:n.storageOptions,storage:n.storage}),sessionStore:null};t.sessionStore=new j(t.core,t.core.logger),await t.sessionStore.init();const e=t.sessionStore.get(n.topic),s=e?.peer.metadata;return t.core=null,t.sessionStore=null,s}},A=class extends P{constructor(n){super(n),this.events=new l.exports,this.on=(t,e)=>this.events.on(t,e),this.once=(t,e)=>this.events.once(t,e),this.off=(t,e)=>this.events.off(t,e),this.removeListener=(t,e)=>this.events.removeListener(t,e),this.pair=async t=>{try{return await this.engine.pair(t)}catch(e){throw this.logger.error(e.message),e}},this.approveSession=async t=>{try{return await this.engine.approveSession(t)}catch(e){throw this.logger.error(e.message),e}},this.rejectSession=async t=>{try{return await this.engine.rejectSession(t)}catch(e){throw this.logger.error(e.message),e}},this.updateSession=async t=>{try{return await this.engine.updateSession(t)}catch(e){throw this.logger.error(e.message),e}},this.extendSession=async t=>{try{return await this.engine.extendSession(t)}catch(e){throw this.logger.error(e.message),e}},this.respondSessionRequest=async t=>{try{return await this.engine.respondSessionRequest(t)}catch(e){throw this.logger.error(e.message),e}},this.disconnectSession=async t=>{try{return await this.engine.disconnectSession(t)}catch(e){throw this.logger.error(e.message),e}},this.emitSessionEvent=async t=>{try{return await this.engine.emitSessionEvent(t)}catch(e){throw this.logger.error(e.message),e}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.respondAuthRequest=async(t,e)=>{try{return await this.engine.respondAuthRequest(t,e)}catch(s){throw this.logger.error(s.message),s}},this.getPendingAuthRequests=()=>{try{return this.engine.getPendingAuthRequests()}catch(t){throw this.logger.error(t.message),t}},this.formatMessage=(t,e)=>{try{return this.engine.formatMessage(t,e)}catch(s){throw this.logger.error(s.message),s}},this.registerDeviceToken=t=>{try{return this.engine.registerDeviceToken(t)}catch(e){throw this.logger.error(e.message),e}},this.metadata=n.metadata,this.name=n.name||p,this.core=n.core,this.logger=this.core.logger,this.engine=new H(this)}static async init(n){const t=new A(n);return await t.initialize(),t}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("Web3Wallet Initialization Success")}catch(n){throw this.logger.info("Web3Wallet Initialization Failure"),this.logger.error(n.message),n}}};let d=A;d.notifications=Q;const V=d;export{p as CLIENT_CONTEXT,X as CLIENT_STORAGE_OPTIONS,U as CLIENT_STORAGE_PREFIX,P as IWeb3Wallet,q as IWeb3WalletEngine,G as IWeb3WalletEvents,x as PROTOCOL,K as PROTOCOL_VERSION,$ as REQUEST_CONTEXT,V as Web3Wallet,d as default};
//# sourceMappingURL=index.es.js.map
